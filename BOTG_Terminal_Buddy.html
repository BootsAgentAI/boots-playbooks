<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Terminal Buddy — Boots On The Ground AI</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --navy: #1B2A4A;
    --navy-light: #243558;
    --blue: #2E86AB;
    --gold: #D4A843;
    --gold-hover: #E0B854;
    --terminal-green: #00D26A;
    --terminal-green-dark: #00A854;
    --light-bg: #F4F7FA;
    --white: #FFFFFF;
    --gray: #6C757D;
    --dark-text: #1a1a2e;
    --code-bg: #1E293B;
    --danger: #EF4444;
    --danger-light: #FEE2E2;
    --sidebar-width: 240px;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--light-bg);
    color: var(--dark-text);
    min-height: 100vh;
  }

  /* ===== HEADER ===== */
  .header {
    background: linear-gradient(135deg, var(--navy) 0%, var(--terminal-green-dark) 100%);
    position: relative;
    overflow: hidden;
  }

  .header::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 5px;
    background: linear-gradient(90deg, var(--gold) 0%, var(--gold) 60%, var(--terminal-green) 100%);
  }

  .header-inner {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem 2rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .header-icon {
    width: 72px;
    height: 72px;
    border-radius: 16px;
    border: 3px solid var(--gold);
    background: rgba(0,0,0,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    flex-shrink: 0;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    color: var(--terminal-green);
    font-family: 'JetBrains Mono', monospace;
    font-weight: 700;
  }

  .header-text h1 {
    font-size: 1.6rem;
    font-weight: 800;
    color: var(--white);
    letter-spacing: -0.02em;
    line-height: 1.2;
  }

  .header-text h1 span { color: var(--terminal-green); }

  .header-text p {
    color: rgba(255,255,255,0.7);
    font-size: 0.9rem;
    font-weight: 500;
    margin-top: 0.25rem;
  }

  .header-stats {
    margin-left: auto;
    display: flex;
    gap: 1.5rem;
  }

  .header-stat {
    text-align: center;
  }

  .header-stat-num {
    font-size: 1.4rem;
    font-weight: 800;
    color: var(--gold);
    line-height: 1;
    font-family: 'JetBrains Mono', monospace;
  }

  .header-stat-label {
    font-size: 0.65rem;
    color: rgba(255,255,255,0.5);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-top: 0.15rem;
  }

  /* ===== BACK LINK ===== */
  .back-link {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1rem 2rem 0;
  }

  .back-link a {
    color: var(--blue);
    text-decoration: none;
    font-size: 0.85rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    transition: color 0.2s;
  }

  .back-link a:hover { color: var(--gold); }

  /* ===== TOOLBAR ===== */
  .toolbar {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1rem 2rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .search-box {
    position: relative;
    flex: 1;
    min-width: 200px;
    max-width: 400px;
  }

  .search-box input {
    width: 100%;
    padding: 0.6rem 1rem 0.6rem 2.4rem;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 0.9rem;
    font-family: inherit;
    outline: none;
    transition: all 0.2s;
    background: var(--white);
  }

  .search-box input:focus {
    border-color: var(--blue);
    box-shadow: 0 0 0 3px rgba(46,134,171,0.1);
  }

  .search-box-icon {
    position: absolute;
    left: 0.8rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
    font-size: 0.9rem;
    pointer-events: none;
  }

  .filter-chips {
    display: flex;
    gap: 0.4rem;
    flex-wrap: wrap;
  }

  .filter-chip {
    padding: 0.4rem 0.75rem;
    border-radius: 20px;
    border: 1.5px solid #e2e8f0;
    background: var(--white);
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--gray);
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .filter-chip:hover {
    border-color: var(--blue);
    color: var(--blue);
  }

  .filter-chip.active {
    background: var(--navy);
    color: var(--white);
    border-color: var(--navy);
  }

  .filter-chip.danger-chip.active {
    background: var(--danger);
    border-color: var(--danger);
  }

  .toolbar-actions {
    display: flex;
    gap: 0.5rem;
    margin-left: auto;
  }

  .toolbar-btn {
    padding: 0.5rem 0.9rem;
    border-radius: 8px;
    border: 1.5px solid #e2e8f0;
    background: var(--white);
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--navy);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.35rem;
    font-family: inherit;
  }

  .toolbar-btn:hover {
    border-color: var(--gold);
    background: #FFFBF0;
  }

  .toolbar-btn.primary {
    background: var(--gold);
    color: var(--navy);
    border-color: var(--gold);
  }

  .toolbar-btn.primary:hover {
    background: var(--gold-hover);
  }

  /* ===== LAYOUT: SIDEBAR + GRID ===== */
  .layout {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem 2rem;
    display: flex;
    gap: 1.5rem;
  }

  /* ===== SIDEBAR ===== */
  .sidebar {
    width: var(--sidebar-width);
    flex-shrink: 0;
  }

  .sidebar-list {
    background: var(--white);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    position: sticky;
    top: 1rem;
  }

  .sidebar-item {
    padding: 0.65rem 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    transition: all 0.15s;
    border-left: 3px solid transparent;
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--dark-text);
  }

  .sidebar-item:hover {
    background: #F8FAFC;
  }

  .sidebar-item.active {
    background: #F0F9FF;
    border-left-color: var(--blue);
    color: var(--blue);
    font-weight: 700;
  }

  .sidebar-item-icon {
    margin-right: 0.5rem;
    font-size: 1rem;
  }

  .sidebar-item-label {
    flex: 1;
  }

  .sidebar-item-count {
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--gray);
    background: #F1F5F9;
    padding: 0.15rem 0.45rem;
    border-radius: 10px;
    min-width: 24px;
    text-align: center;
  }

  .sidebar-item.active .sidebar-item-count {
    background: rgba(46,134,171,0.15);
    color: var(--blue);
  }

  /* ===== MOBILE TOOL PILLS ===== */
  .mobile-pills {
    display: none;
    overflow-x: auto;
    gap: 0.4rem;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
    -webkit-overflow-scrolling: touch;
  }

  .mobile-pills::-webkit-scrollbar { display: none; }

  .mobile-pill {
    padding: 0.45rem 0.9rem;
    border-radius: 20px;
    border: 1.5px solid #e2e8f0;
    background: var(--white);
    font-size: 0.78rem;
    font-weight: 600;
    color: var(--gray);
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.2s;
    flex-shrink: 0;
  }

  .mobile-pill.active {
    background: var(--navy);
    color: var(--white);
    border-color: var(--navy);
  }

  /* ===== COMMAND GRID ===== */
  .command-grid-wrapper {
    flex: 1;
    min-width: 0;
  }

  .results-info {
    font-size: 0.8rem;
    color: var(--gray);
    margin-bottom: 0.75rem;
    font-weight: 500;
  }

  .command-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1rem;
  }

  .no-results {
    grid-column: 1 / -1;
    text-align: center;
    padding: 4rem 2rem;
    color: var(--gray);
  }

  .no-results-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.4;
  }

  .no-results h3 {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--navy);
    margin-bottom: 0.35rem;
  }

  /* ===== COMMAND CARD ===== */
  .command-card {
    background: var(--white);
    border-radius: 16px;
    padding: 1.1rem 1.25rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 4px 12px rgba(0,0,0,0.04);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    border-left: 4px solid transparent;
  }

  .command-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(27, 42, 74, 0.12);
  }

  .command-card.danger {
    border-left-color: var(--danger);
  }

  .card-top {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .card-tool-badge {
    font-size: 0.65rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    padding: 0.2rem 0.5rem;
    border-radius: 5px;
    color: var(--white);
    white-space: nowrap;
  }

  .card-badges {
    display: flex;
    gap: 0.3rem;
    flex-wrap: wrap;
  }

  .card-tag {
    font-size: 0.6rem;
    font-weight: 700;
    padding: 0.15rem 0.4rem;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .tag-most-used { background: #DBEAFE; color: #1E40AF; }
  .tag-superpower { background: #F3E8FF; color: #7C3AED; }
  .tag-danger-zone { background: var(--danger-light); color: var(--danger); }
  .tag-beginner { background: #D1FAE5; color: #065F46; }
  .tag-intermediate { background: #FEF3C7; color: #92400E; }
  .tag-advanced { background: #FCE7F3; color: #9D174D; }
  .tag-custom { background: linear-gradient(135deg, #D4A843, #E0B854); color: var(--navy); }

  .card-desc {
    font-size: 0.85rem;
    color: var(--dark-text);
    line-height: 1.5;
    margin-bottom: 0.6rem;
    font-weight: 500;
  }

  .card-code-wrapper {
    position: relative;
    margin-bottom: 0.5rem;
  }

  .card-code {
    background: var(--code-bg);
    border-radius: 8px;
    padding: 0.7rem 2.8rem 0.7rem 0.85rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    color: var(--terminal-green);
    overflow-x: auto;
    white-space: pre-wrap;
    word-break: break-all;
    line-height: 1.5;
  }

  .copy-btn {
    position: absolute;
    top: 0.45rem;
    right: 0.45rem;
    background: rgba(255,255,255,0.1);
    border: none;
    border-radius: 6px;
    padding: 0.3rem 0.5rem;
    cursor: pointer;
    color: rgba(255,255,255,0.5);
    font-size: 0.75rem;
    transition: all 0.2s;
  }

  .copy-btn:hover {
    background: rgba(255,255,255,0.2);
    color: var(--white);
  }

  .copy-btn.copied {
    color: var(--terminal-green);
    background: rgba(0,210,106,0.15);
  }

  .card-difficulty {
    font-size: 0.7rem;
    color: var(--gray);
    font-weight: 500;
  }

  .card-actions {
    display: flex;
    gap: 0.4rem;
    margin-top: 0.6rem;
    padding-top: 0.6rem;
    border-top: 1px solid #f0f0f0;
  }

  .card-action-btn {
    padding: 0.3rem 0.6rem;
    border-radius: 6px;
    border: 1.5px solid #e2e8f0;
    background: var(--white);
    font-size: 0.7rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s;
    font-family: inherit;
    color: var(--gray);
  }

  .card-action-btn:hover {
    border-color: var(--blue);
    color: var(--blue);
    background: #F0F9FF;
  }

  .card-action-btn.delete-btn:hover {
    border-color: var(--danger);
    color: var(--danger);
    background: var(--danger-light);
  }

  /* ===== MODAL ===== */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(27, 42, 74, 0.6);
    backdrop-filter: blur(4px);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }

  .modal-overlay.show {
    display: flex;
  }

  .modal {
    background: var(--white);
    border-radius: 20px;
    width: 100%;
    max-width: 560px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  }

  .modal-header {
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .modal-header h2 {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--navy);
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 1.3rem;
    cursor: pointer;
    color: var(--gray);
    padding: 0.25rem;
    border-radius: 6px;
    transition: all 0.2s;
  }

  .modal-close:hover {
    background: #f0f0f0;
    color: var(--navy);
  }

  .modal-body {
    padding: 1.5rem;
  }

  .form-group {
    margin-bottom: 1rem;
  }

  .form-group label {
    display: block;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--navy);
    margin-bottom: 0.35rem;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 0.55rem 0.8rem;
    border: 1.5px solid #e2e8f0;
    border-radius: 8px;
    font-size: 0.85rem;
    font-family: inherit;
    outline: none;
    transition: border-color 0.2s;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    border-color: var(--blue);
  }

  .form-group textarea {
    font-family: 'JetBrains Mono', monospace;
    resize: vertical;
    min-height: 60px;
  }

  .modal-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid #f0f0f0;
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
  }

  .modal-btn {
    padding: 0.55rem 1.2rem;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    border: 1.5px solid #e2e8f0;
    background: var(--white);
    color: var(--navy);
    transition: all 0.2s;
    font-family: inherit;
  }

  .modal-btn:hover { background: #f8fafc; }

  .modal-btn.primary {
    background: var(--gold);
    color: var(--navy);
    border-color: var(--gold);
  }

  .modal-btn.primary:hover {
    background: var(--gold-hover);
  }

  .modal-btn.danger {
    background: var(--danger);
    color: var(--white);
    border-color: var(--danger);
  }

  .modal-btn.danger:hover {
    background: #DC2626;
  }

  /* ===== NEW TOOL FIELDS ===== */
  .new-tool-fields {
    display: none;
    background: #F8FAFC;
    border: 1.5px solid #e2e8f0;
    border-radius: 10px;
    padding: 1rem;
    margin-top: 0.5rem;
  }

  .new-tool-fields.show { display: block; }

  .new-tool-fields .form-group { margin-bottom: 0.75rem; }
  .new-tool-fields .form-group:last-child { margin-bottom: 0; }

  .new-tool-row {
    display: flex;
    gap: 0.75rem;
  }

  .new-tool-row .form-group { flex: 1; }

  .color-preview {
    display: inline-block;
    width: 22px;
    height: 22px;
    border-radius: 6px;
    vertical-align: middle;
    margin-left: 0.5rem;
    border: 1.5px solid #e2e8f0;
  }

  /* ===== SIDEBAR EDIT BUTTON ===== */
  .sidebar-item-edit {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.7rem;
    color: var(--gray);
    padding: 0.15rem 0.3rem;
    border-radius: 4px;
    opacity: 0;
    transition: all 0.15s;
    margin-left: 0.3rem;
  }

  .sidebar-item:hover .sidebar-item-edit { opacity: 1; }
  .sidebar-item-edit:hover { background: #e2e8f0; color: var(--navy); }

  /* ===== EDIT TOOL MODAL ===== */
  .edit-tool-preview {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    background: #F8FAFC;
    border-radius: 10px;
    margin-bottom: 1rem;
  }

  .edit-tool-preview-badge {
    padding: 0.3rem 0.6rem;
    border-radius: 6px;
    color: white;
    font-weight: 700;
    font-size: 0.85rem;
  }

  /* ===== IMPORT MODAL ===== */
  .import-modal { max-width: 700px; }

  .drop-zone {
    border: 2px dashed #d0d5dd;
    border-radius: 12px;
    padding: 2.5rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    background: #FAFBFC;
  }

  .drop-zone:hover,
  .drop-zone.drag-over {
    border-color: var(--blue);
    background: #F0F9FF;
  }

  .drop-zone-icon { font-size: 2.5rem; margin-bottom: 0.5rem; opacity: 0.4; }
  .drop-zone-text { font-size: 0.9rem; font-weight: 600; color: var(--navy); }
  .drop-zone-hint { font-size: 0.75rem; color: var(--gray); margin-top: 0.25rem; }

  .import-preview { margin-top: 1rem; }

  .import-preview-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.8rem;
  }

  .import-preview-table th {
    text-align: left;
    padding: 0.5rem;
    background: #F8FAFC;
    font-weight: 700;
    color: var(--navy);
    border-bottom: 2px solid #e2e8f0;
  }

  .import-preview-table td {
    padding: 0.45rem 0.5rem;
    border-bottom: 1px solid #f0f0f0;
    vertical-align: middle;
  }

  .import-preview-table code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    background: var(--code-bg);
    color: var(--terminal-green);
    padding: 0.15rem 0.4rem;
    border-radius: 4px;
  }

  .import-preview-table select {
    padding: 0.25rem 0.4rem;
    border: 1px solid #e2e8f0;
    border-radius: 5px;
    font-size: 0.75rem;
    font-family: inherit;
  }

  .import-file-info {
    font-size: 0.8rem;
    color: var(--gray);
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  /* ===== TOAST ===== */
  .toast {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: var(--navy);
    color: var(--white);
    padding: 0.7rem 1.2rem;
    border-radius: 10px;
    font-size: 0.85rem;
    font-weight: 600;
    box-shadow: 0 8px 30px rgba(0,0,0,0.2);
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 2000;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .toast.show {
    transform: translateY(0);
    opacity: 1;
  }

  .toast-icon { font-size: 1rem; }

  /* ===== FOOTER ===== */
  .footer {
    background: var(--navy);
    padding: 1.5rem 2rem;
    text-align: center;
  }

  .footer p {
    color: rgba(255,255,255,0.4);
    font-size: 0.8rem;
  }

  .footer a {
    color: var(--gold);
    text-decoration: none;
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 900px) {
    .sidebar { display: none; }
    .mobile-pills { display: flex; }
    .command-grid { grid-template-columns: 1fr; }
    .header-stats { display: none; }
    .header-inner { padding: 1.5rem 1rem 1rem; }
    .toolbar { padding: 0.75rem 1rem; flex-direction: column; align-items: stretch; }
    .search-box { max-width: 100%; }
    .filter-chips { overflow-x: auto; flex-wrap: nowrap; padding-bottom: 0.25rem; }
    .toolbar-actions { justify-content: center; }
    .layout { padding: 0 1rem 1.5rem; }
    .back-link { padding: 0.75rem 1rem 0; }
  }

  @media (max-width: 480px) {
    .header-text h1 { font-size: 1.2rem; }
    .header-icon { width: 56px; height: 56px; font-size: 1.5rem; }
    .toolbar-actions { flex-wrap: wrap; }
    .toolbar-btn { font-size: 0.72rem; padding: 0.4rem 0.7rem; }
  }
</style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div class="header-inner">
      <div class="header-icon">$_</div>
      <div class="header-text">
        <h1>TERMINAL <span>BUDDY</span></h1>
        <p>Your personal CLI command reference</p>
      </div>
      <div class="header-stats">
        <div class="header-stat">
          <div class="header-stat-num" id="stat-commands">102</div>
          <div class="header-stat-label">Commands</div>
        </div>
        <div class="header-stat">
          <div class="header-stat-num" id="stat-tools">10</div>
          <div class="header-stat-label">Tools</div>
        </div>
        <div class="header-stat">
          <div class="header-stat-num" id="stat-custom">0</div>
          <div class="header-stat-label">Custom</div>
        </div>
      </div>
    </div>
  </header>

  <!-- BACK LINK -->
  <div class="back-link">
    <a href="index.html">&#8592; Back to Playbook Hub</a>
  </div>

  <!-- TOOLBAR -->
  <div class="toolbar">
    <div class="search-box">
      <span class="search-box-icon">&#128269;</span>
      <input type="text" placeholder="Search commands..." id="search-input" autocomplete="off" />
    </div>
    <div class="filter-chips">
      <button class="filter-chip active" data-filter="all">All</button>
      <button class="filter-chip" data-filter="most-used">Most Used</button>
      <button class="filter-chip" data-filter="superpower">Superpower</button>
      <button class="filter-chip danger-chip" data-filter="danger-zone">Danger Zone</button>
      <button class="filter-chip" data-filter="beginner">Beginner</button>
      <button class="filter-chip" data-filter="intermediate">Intermediate</button>
      <button class="filter-chip" data-filter="advanced">Advanced</button>
    </div>
    <div class="toolbar-actions">
      <button class="toolbar-btn primary" onclick="openAddModal()">+ Add</button>
      <button class="toolbar-btn" onclick="openImportModal()">&#128229; Import</button>
      <button class="toolbar-btn" onclick="exportCommands()">&#128228; Export</button>
    </div>
  </div>

  <!-- LAYOUT -->
  <div class="layout">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-list" id="sidebar-list"></div>
    </aside>

    <!-- MAIN GRID -->
    <div class="command-grid-wrapper">
      <!-- MOBILE TOOL PILLS -->
      <div class="mobile-pills" id="mobile-pills"></div>

      <div class="results-info" id="results-info"></div>
      <div class="command-grid" id="command-grid"></div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <p>&copy; 2026 <a href="https://bootsagentai.com">Boots On The Ground AI</a> &mdash; AI Solutions for Small Business Owners</p>
  </footer>

  <!-- ADD COMMAND MODAL -->
  <div class="modal-overlay" id="add-modal">
    <div class="modal">
      <div class="modal-header">
        <h2>Add Custom Command</h2>
        <button class="modal-close" onclick="closeAddModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Tool</label>
          <select id="add-tool" onchange="onToolSelectChange(this)">
            <!-- Populated dynamically -->
          </select>
          <div class="new-tool-fields" id="new-tool-fields">
            <div class="form-group">
              <label>Tool Name</label>
              <input type="text" id="new-tool-name" placeholder="e.g. Python, Terraform, AWS CLI" />
            </div>
            <div class="new-tool-row">
              <div class="form-group">
                <label>Icon (emoji)</label>
                <input type="text" id="new-tool-icon" placeholder="e.g. &#128013;" maxlength="4" style="font-size:1.2rem;text-align:center;" />
              </div>
              <div class="form-group">
                <label>Color <span class="color-preview" id="new-tool-color-preview" style="background:#6366F1;"></span></label>
                <input type="color" id="new-tool-color" value="#6366F1" style="height:36px;padding:2px;cursor:pointer;" onchange="document.getElementById('new-tool-color-preview').style.background=this.value" />
              </div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label>Command</label>
          <textarea id="add-command" placeholder="docker build -t my-app ."></textarea>
        </div>
        <div class="form-group">
          <label>Description</label>
          <input type="text" id="add-description" placeholder="What does this command do?" />
        </div>
        <div class="form-group">
          <label>Difficulty</label>
          <select id="add-difficulty">
            <option value="beginner">Beginner</option>
            <option value="intermediate" selected>Intermediate</option>
            <option value="advanced">Advanced</option>
          </select>
        </div>
        <div class="form-group">
          <label>Type</label>
          <select id="add-type">
            <option value="most-used">Most Used</option>
            <option value="superpower">Superpower</option>
            <option value="danger-zone">Danger Zone</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn" onclick="closeAddModal()">Cancel</button>
        <button class="modal-btn primary" onclick="saveCommand()">Add Command</button>
      </div>
    </div>
  </div>

  <!-- EDIT COMMAND MODAL -->
  <div class="modal-overlay" id="edit-cmd-modal">
    <div class="modal">
      <div class="modal-header">
        <h2>Edit Command</h2>
        <button class="modal-close" onclick="closeEditCommandModal()">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="edit-cmd-id" />
        <div class="form-group">
          <label>Tool</label>
          <select id="edit-cmd-tool"></select>
        </div>
        <div class="form-group">
          <label>Command</label>
          <textarea id="edit-cmd-command" placeholder="docker build -t my-app ."></textarea>
        </div>
        <div class="form-group">
          <label>Description</label>
          <input type="text" id="edit-cmd-description" placeholder="What does this command do?" />
        </div>
        <div class="form-group">
          <label>Difficulty</label>
          <select id="edit-cmd-difficulty">
            <option value="beginner">Beginner</option>
            <option value="intermediate">Intermediate</option>
            <option value="advanced">Advanced</option>
          </select>
        </div>
        <div class="form-group">
          <label>Type</label>
          <select id="edit-cmd-type">
            <option value="most-used">Most Used</option>
            <option value="superpower">Superpower</option>
            <option value="danger-zone">Danger Zone</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn" onclick="closeEditCommandModal()">Cancel</button>
        <button class="modal-btn primary" onclick="saveEditCommand()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- IMPORT MODAL -->
  <div class="modal-overlay" id="import-modal">
    <div class="modal import-modal">
      <div class="modal-header">
        <h2>Import from Markdown</h2>
        <button class="modal-close" onclick="closeImportModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="drop-zone" id="drop-zone">
          <div class="drop-zone-icon">&#128196;</div>
          <div class="drop-zone-text">Drop a .md file here or click to browse</div>
          <div class="drop-zone-hint">Supports fenced code blocks and inline code in lists</div>
          <input type="file" id="file-input" accept=".md,.markdown,.txt" style="display:none" />
        </div>
        <div class="import-preview" id="import-preview" style="display:none;"></div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn" onclick="closeImportModal()">Cancel</button>
        <button class="modal-btn primary" id="import-confirm-btn" onclick="confirmImport()" style="display:none;">Import Commands</button>
      </div>
    </div>
  </div>

  <!-- EDIT TOOL MODAL -->
  <div class="modal-overlay" id="edit-tool-modal">
    <div class="modal">
      <div class="modal-header">
        <h2>Edit Custom Tool</h2>
        <button class="modal-close" onclick="closeEditToolModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="edit-tool-preview" id="edit-tool-preview"></div>
        <input type="hidden" id="edit-tool-original-name" />
        <div class="form-group">
          <label>Tool Name</label>
          <input type="text" id="edit-tool-name" placeholder="e.g. Python" />
        </div>
        <div class="new-tool-row">
          <div class="form-group">
            <label>Icon (emoji)</label>
            <input type="text" id="edit-tool-icon" placeholder="&#128013;" maxlength="4" style="font-size:1.2rem;text-align:center;" />
          </div>
          <div class="form-group">
            <label>Color <span class="color-preview" id="edit-tool-color-preview"></span></label>
            <input type="color" id="edit-tool-color" style="height:36px;padding:2px;cursor:pointer;" onchange="document.getElementById('edit-tool-color-preview').style.background=this.value;updateEditToolPreview()" />
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn danger" onclick="deleteCustomTool()">Delete Tool</button>
        <button class="modal-btn" onclick="closeEditToolModal()">Cancel</button>
        <button class="modal-btn primary" onclick="saveEditTool()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast">
    <span class="toast-icon" id="toast-icon"></span>
    <span id="toast-message"></span>
  </div>

<script>
// ===== TOOL CONFIG =====
const TOOL_CONFIG = {
  'Docker':           { icon: '&#128051;', color: '#0db7ed' },
  'Git/GitHub':       { icon: '&#128737;', color: '#24292E' },
  'Claude Code':      { icon: '&#9889;',   color: '#E07C3E' },
  'Vercel':           { icon: '&#9650;',   color: '#000000' },
  'Supabase':         { icon: '&#9889;',   color: '#3ECF8E' },
  'Google Cloud Run': { icon: '&#9729;',   color: '#4285F4' },
  'Fly.io':           { icon: '&#128640;', color: '#8B5CF6' },
  'Mac/Terminal':     { icon: '&#128187;', color: '#555555' },
  'npm/Node.js':      { icon: '&#128230;', color: '#CB3837' },
  'Sentry':           { icon: '&#128737;', color: '#362D59' }
};

// ===== BUILT-IN COMMANDS (102 total) =====
const BUILTIN_COMMANDS = [
  // === DOCKER (10) ===
  { id:'d1',  tool:'Docker', command:'docker build -t <name> .', description:'Build an image from a Dockerfile in the current directory', difficulty:'beginner', type:'most-used' },
  { id:'d2',  tool:'Docker', command:'docker run -d -p 3000:3000 <image>', description:'Run a container in detached mode with port mapping', difficulty:'beginner', type:'most-used' },
  { id:'d3',  tool:'Docker', command:'docker ps -a', description:'List all containers including stopped ones', difficulty:'beginner', type:'most-used' },
  { id:'d4',  tool:'Docker', command:'docker compose up -d', description:'Start all services defined in docker-compose.yml in background', difficulty:'beginner', type:'most-used' },
  { id:'d5',  tool:'Docker', command:'docker compose down -v', description:'Stop and remove containers, networks, and volumes', difficulty:'intermediate', type:'danger-zone' },
  { id:'d6',  tool:'Docker', command:'docker logs -f <container>', description:'Follow live log output of a container', difficulty:'beginner', type:'most-used' },
  { id:'d7',  tool:'Docker', command:'docker exec -it <container> sh', description:'Open an interactive shell inside a running container', difficulty:'intermediate', type:'superpower' },
  { id:'d8',  tool:'Docker', command:'docker system prune -a --volumes', description:'Remove all unused images, containers, networks, and volumes', difficulty:'advanced', type:'danger-zone' },
  { id:'d9',  tool:'Docker', command:'docker buildx build --platform linux/amd64 -t <image> .', description:'Build a multi-platform image (useful for deploying from Apple Silicon)', difficulty:'advanced', type:'superpower' },
  { id:'d10', tool:'Docker', command:'docker inspect <container>', description:'View detailed low-level info on a container or image', difficulty:'intermediate', type:'superpower' },

  // === GIT/GITHUB (12) ===
  { id:'g1',  tool:'Git/GitHub', command:'git status', description:'Show the working tree status — staged, unstaged, untracked files', difficulty:'beginner', type:'most-used' },
  { id:'g2',  tool:'Git/GitHub', command:'git add . && git commit -m "message"', description:'Stage all changes and commit with a message', difficulty:'beginner', type:'most-used' },
  { id:'g3',  tool:'Git/GitHub', command:'git push origin main', description:'Push local commits to the main branch on the remote', difficulty:'beginner', type:'most-used' },
  { id:'g4',  tool:'Git/GitHub', command:'git checkout -b <branch-name>', description:'Create and switch to a new branch', difficulty:'beginner', type:'most-used' },
  { id:'g5',  tool:'Git/GitHub', command:'git log --oneline -20', description:'Show the last 20 commits in a compact one-line format', difficulty:'beginner', type:'most-used' },
  { id:'g6',  tool:'Git/GitHub', command:'git stash && git stash pop', description:'Temporarily save changes and restore them later', difficulty:'intermediate', type:'superpower' },
  { id:'g7',  tool:'Git/GitHub', command:'git rebase -i HEAD~3', description:'Interactively rebase the last 3 commits (squash, edit, reorder)', difficulty:'advanced', type:'superpower' },
  { id:'g8',  tool:'Git/GitHub', command:'git reset --hard HEAD~1', description:'Permanently discard the last commit and all changes', difficulty:'advanced', type:'danger-zone' },
  { id:'g9',  tool:'Git/GitHub', command:'git push --force-with-lease', description:'Force push with safety check that remote has not changed', difficulty:'advanced', type:'danger-zone' },
  { id:'g10', tool:'Git/GitHub', command:'gh pr create --fill', description:'Create a pull request with auto-filled title and body from commits', difficulty:'intermediate', type:'superpower' },
  { id:'g11', tool:'Git/GitHub', command:'gh repo clone <owner/repo>', description:'Clone a GitHub repository using the GitHub CLI', difficulty:'beginner', type:'most-used' },
  { id:'g12', tool:'Git/GitHub', command:'git diff --staged', description:'Show changes that are staged for the next commit', difficulty:'beginner', type:'most-used' },

  // === CLAUDE CODE (10) ===
  { id:'c1',  tool:'Claude Code', command:'claude', description:'Launch Claude Code in interactive mode in the current directory', difficulty:'beginner', type:'most-used' },
  { id:'c2',  tool:'Claude Code', command:'claude "fix the login bug"', description:'Start a session with an initial prompt', difficulty:'beginner', type:'most-used' },
  { id:'c3',  tool:'Claude Code', command:'claude --resume', description:'Resume the most recent conversation', difficulty:'beginner', type:'most-used' },
  { id:'c4',  tool:'Claude Code', command:'claude -p "explain this code" < file.ts', description:'Pipe a file into Claude for analysis (non-interactive)', difficulty:'intermediate', type:'superpower' },
  { id:'c5',  tool:'Claude Code', command:'cat log.txt | claude -p "find errors"', description:'Pipe output into Claude for analysis', difficulty:'intermediate', type:'superpower' },
  { id:'c6',  tool:'Claude Code', command:'/compact', description:'Compress conversation context to free up the context window', difficulty:'beginner', type:'most-used' },
  { id:'c7',  tool:'Claude Code', command:'/cost', description:'Show token usage and cost for the current session', difficulty:'beginner', type:'most-used' },
  { id:'c8',  tool:'Claude Code', command:'/init', description:'Generate a CLAUDE.md project file with codebase context', difficulty:'intermediate', type:'superpower' },
  { id:'c9',  tool:'Claude Code', command:'claude config set model claude-sonnet-4-5-20250929', description:'Switch Claude Code to use the Sonnet model for faster responses', difficulty:'intermediate', type:'superpower' },
  { id:'c10', tool:'Claude Code', command:'claude --dangerously-skip-permissions', description:'Run Claude Code without permission prompts (use with caution)', difficulty:'advanced', type:'danger-zone' },

  // === VERCEL (10) ===
  { id:'v1',  tool:'Vercel', command:'vercel', description:'Deploy the current project to Vercel (preview deployment)', difficulty:'beginner', type:'most-used' },
  { id:'v2',  tool:'Vercel', command:'vercel --prod', description:'Deploy directly to production', difficulty:'beginner', type:'most-used' },
  { id:'v3',  tool:'Vercel', command:'vercel env pull .env.local', description:'Pull environment variables from Vercel to local .env.local', difficulty:'intermediate', type:'most-used' },
  { id:'v4',  tool:'Vercel', command:'vercel env add <KEY>', description:'Add a new environment variable to your Vercel project', difficulty:'intermediate', type:'most-used' },
  { id:'v5',  tool:'Vercel', command:'vercel logs <url>', description:'View runtime logs for a specific deployment URL', difficulty:'intermediate', type:'superpower' },
  { id:'v6',  tool:'Vercel', command:'vercel inspect <url>', description:'View build and deployment details for a deployment', difficulty:'intermediate', type:'superpower' },
  { id:'v7',  tool:'Vercel', command:'vercel link', description:'Link the current directory to an existing Vercel project', difficulty:'beginner', type:'most-used' },
  { id:'v8',  tool:'Vercel', command:'vercel dev', description:'Run the Vercel development server locally (emulates serverless)', difficulty:'intermediate', type:'superpower' },
  { id:'v9',  tool:'Vercel', command:'vercel domains add <domain>', description:'Add a custom domain to your Vercel project', difficulty:'intermediate', type:'superpower' },
  { id:'v10', tool:'Vercel', command:'vercel rm <deployment-url>', description:'Delete a specific deployment permanently', difficulty:'advanced', type:'danger-zone' },

  // === SUPABASE (10) ===
  { id:'s1',  tool:'Supabase', command:'supabase init', description:'Initialize a new Supabase project in the current directory', difficulty:'beginner', type:'most-used' },
  { id:'s2',  tool:'Supabase', command:'supabase start', description:'Start the local Supabase stack (Postgres, Auth, Storage, etc.)', difficulty:'beginner', type:'most-used' },
  { id:'s3',  tool:'Supabase', command:'supabase stop', description:'Stop the local Supabase development stack', difficulty:'beginner', type:'most-used' },
  { id:'s4',  tool:'Supabase', command:'supabase db push', description:'Push local migrations to the remote Supabase database', difficulty:'intermediate', type:'most-used' },
  { id:'s5',  tool:'Supabase', command:'supabase migration new <name>', description:'Create a new migration file', difficulty:'intermediate', type:'most-used' },
  { id:'s6',  tool:'Supabase', command:'supabase db reset', description:'Reset local database — runs all migrations from scratch', difficulty:'intermediate', type:'danger-zone' },
  { id:'s7',  tool:'Supabase', command:'supabase gen types typescript --local', description:'Generate TypeScript types from your local database schema', difficulty:'intermediate', type:'superpower' },
  { id:'s8',  tool:'Supabase', command:'supabase link --project-ref <ref>', description:'Link local project to a remote Supabase project', difficulty:'intermediate', type:'most-used' },
  { id:'s9',  tool:'Supabase', command:'supabase secrets set KEY=value', description:'Set a secret environment variable on the remote project', difficulty:'intermediate', type:'superpower' },
  { id:'s10', tool:'Supabase', command:'supabase functions serve', description:'Serve Edge Functions locally for development', difficulty:'intermediate', type:'superpower' },

  // === GOOGLE CLOUD RUN (10) ===
  { id:'cr1',  tool:'Google Cloud Run', command:'gcloud run deploy <service> --source .', description:'Build and deploy a service from source code in one step', difficulty:'beginner', type:'most-used' },
  { id:'cr2',  tool:'Google Cloud Run', command:'gcloud run services list', description:'List all Cloud Run services in the current project', difficulty:'beginner', type:'most-used' },
  { id:'cr3',  tool:'Google Cloud Run', command:'gcloud run services describe <service>', description:'Show details of a specific Cloud Run service', difficulty:'beginner', type:'most-used' },
  { id:'cr4',  tool:'Google Cloud Run', command:'gcloud run deploy <service> --image <image> --port 3000', description:'Deploy a pre-built container image with a specific port', difficulty:'intermediate', type:'most-used' },
  { id:'cr5',  tool:'Google Cloud Run', command:'gcloud run services update <service> --set-env-vars KEY=val', description:'Update environment variables on a running service', difficulty:'intermediate', type:'superpower' },
  { id:'cr6',  tool:'Google Cloud Run', command:'gcloud run services delete <service>', description:'Delete a Cloud Run service permanently', difficulty:'advanced', type:'danger-zone' },
  { id:'cr7',  tool:'Google Cloud Run', command:'gcloud builds submit --tag gcr.io/<project>/<image>', description:'Build a container image with Cloud Build and push to GCR', difficulty:'intermediate', type:'superpower' },
  { id:'cr8',  tool:'Google Cloud Run', command:'gcloud run services update-traffic <service> --to-latest', description:'Route 100% traffic to the latest revision', difficulty:'intermediate', type:'superpower' },
  { id:'cr9',  tool:'Google Cloud Run', command:'gcloud run revisions list --service <service>', description:'List all revisions of a Cloud Run service', difficulty:'intermediate', type:'superpower' },
  { id:'cr10', tool:'Google Cloud Run', command:'gcloud auth configure-docker', description:'Configure Docker to authenticate with Google Container Registry', difficulty:'beginner', type:'most-used' },

  // === FLY.IO (10) ===
  { id:'f1',  tool:'Fly.io', command:'fly launch', description:'Initialize and deploy a new app on Fly.io (interactive setup)', difficulty:'beginner', type:'most-used' },
  { id:'f2',  tool:'Fly.io', command:'fly deploy', description:'Deploy the current app using the fly.toml configuration', difficulty:'beginner', type:'most-used' },
  { id:'f3',  tool:'Fly.io', command:'fly status', description:'Show the current status of your app and its instances', difficulty:'beginner', type:'most-used' },
  { id:'f4',  tool:'Fly.io', command:'fly logs', description:'Stream live logs from your Fly.io app', difficulty:'beginner', type:'most-used' },
  { id:'f5',  tool:'Fly.io', command:'fly secrets set KEY=value', description:'Set a secret environment variable on your Fly app', difficulty:'intermediate', type:'most-used' },
  { id:'f6',  tool:'Fly.io', command:'fly ssh console', description:'Open an SSH session into a running Fly.io machine', difficulty:'intermediate', type:'superpower' },
  { id:'f7',  tool:'Fly.io', command:'fly scale count 2', description:'Scale your app to run 2 instances', difficulty:'intermediate', type:'superpower' },
  { id:'f8',  tool:'Fly.io', command:'fly volumes create <name> --size 1 --region ord', description:'Create a persistent volume in a specific region', difficulty:'advanced', type:'superpower' },
  { id:'f9',  tool:'Fly.io', command:'fly apps destroy <app-name>', description:'Permanently delete a Fly.io app and all its resources', difficulty:'advanced', type:'danger-zone' },
  { id:'f10', tool:'Fly.io', command:'fly proxy 5432:5432 -a <db-app>', description:'Proxy a remote Fly database port to localhost', difficulty:'advanced', type:'superpower' },

  // === MAC/TERMINAL (12) ===
  { id:'m1',  tool:'Mac/Terminal', command:'ls -la', description:'List all files including hidden, with details', difficulty:'beginner', type:'most-used' },
  { id:'m2',  tool:'Mac/Terminal', command:'cd ~/projects && ls', description:'Navigate to projects folder and list contents', difficulty:'beginner', type:'most-used' },
  { id:'m3',  tool:'Mac/Terminal', command:'mkdir -p src/components', description:'Create nested directories (creates parents if needed)', difficulty:'beginner', type:'most-used' },
  { id:'m4',  tool:'Mac/Terminal', command:'cat .env', description:'Display the contents of a file', difficulty:'beginner', type:'most-used' },
  { id:'m5',  tool:'Mac/Terminal', command:'grep -r "TODO" src/', description:'Search for "TODO" recursively in all files under src/', difficulty:'intermediate', type:'superpower' },
  { id:'m6',  tool:'Mac/Terminal', command:'find . -name "*.log" -delete', description:'Find and delete all .log files in the current tree', difficulty:'advanced', type:'danger-zone' },
  { id:'m7',  tool:'Mac/Terminal', command:'lsof -i :3000', description:'Find which process is using port 3000', difficulty:'intermediate', type:'superpower' },
  { id:'m8',  tool:'Mac/Terminal', command:'kill -9 <PID>', description:'Force kill a process by its process ID', difficulty:'intermediate', type:'danger-zone' },
  { id:'m9',  tool:'Mac/Terminal', command:'chmod +x script.sh', description:'Make a script file executable', difficulty:'intermediate', type:'most-used' },
  { id:'m10', tool:'Mac/Terminal', command:'du -sh *', description:'Show disk usage summary of each item in the current directory', difficulty:'intermediate', type:'superpower' },
  { id:'m11', tool:'Mac/Terminal', command:'pbcopy < file.txt', description:'Copy the contents of a file to the clipboard (macOS)', difficulty:'beginner', type:'superpower' },
  { id:'m12', tool:'Mac/Terminal', command:'rm -rf <directory>', description:'Recursively force delete a directory and all its contents', difficulty:'advanced', type:'danger-zone' },

  // === NPM/NODE.JS (10) ===
  { id:'n1',  tool:'npm/Node.js', command:'npm init -y', description:'Initialize a new package.json with defaults', difficulty:'beginner', type:'most-used' },
  { id:'n2',  tool:'npm/Node.js', command:'npm install <package>', description:'Install a package and add it to dependencies', difficulty:'beginner', type:'most-used' },
  { id:'n3',  tool:'npm/Node.js', command:'npm run dev', description:'Run the dev script (usually starts development server)', difficulty:'beginner', type:'most-used' },
  { id:'n4',  tool:'npm/Node.js', command:'npm run build', description:'Run the build script (compile/bundle for production)', difficulty:'beginner', type:'most-used' },
  { id:'n5',  tool:'npm/Node.js', command:'npx create-next-app@latest my-app', description:'Scaffold a new Next.js project with the latest template', difficulty:'beginner', type:'most-used' },
  { id:'n6',  tool:'npm/Node.js', command:'npm ls --depth=0', description:'List top-level installed packages', difficulty:'intermediate', type:'superpower' },
  { id:'n7',  tool:'npm/Node.js', command:'npm outdated', description:'Check for outdated packages and show latest versions', difficulty:'intermediate', type:'superpower' },
  { id:'n8',  tool:'npm/Node.js', command:'npm audit fix', description:'Automatically fix known security vulnerabilities', difficulty:'intermediate', type:'most-used' },
  { id:'n9',  tool:'npm/Node.js', command:'npm cache clean --force', description:'Clear the npm cache (can fix weird install issues)', difficulty:'intermediate', type:'danger-zone' },
  { id:'n10', tool:'npm/Node.js', command:'npx depcheck', description:'Find unused dependencies in your project', difficulty:'intermediate', type:'superpower' },

  // === SENTRY (8) ===
  { id:'se1', tool:'Sentry', command:'sentry-cli login', description:'Authenticate the Sentry CLI with your account', difficulty:'beginner', type:'most-used' },
  { id:'se2', tool:'Sentry', command:'sentry-cli releases new <version>', description:'Create a new release in Sentry', difficulty:'intermediate', type:'most-used' },
  { id:'se3', tool:'Sentry', command:'sentry-cli releases files <ver> upload-sourcemaps ./dist', description:'Upload source maps for better error stack traces', difficulty:'intermediate', type:'most-used' },
  { id:'se4', tool:'Sentry', command:'sentry-cli releases finalize <version>', description:'Mark a release as finalized (deployed)', difficulty:'intermediate', type:'most-used' },
  { id:'se5', tool:'Sentry', command:'sentry-cli releases deploys <ver> new -e production', description:'Register a deployment for a release in a given environment', difficulty:'intermediate', type:'superpower' },
  { id:'se6', tool:'Sentry', command:'sentry-cli send-event -m "Test event"', description:'Send a test event to verify Sentry is working', difficulty:'beginner', type:'most-used' },
  { id:'se7', tool:'Sentry', command:'sentry-cli monitors run <id> -- <command>', description:'Wrap a cron job so Sentry monitors its execution', difficulty:'advanced', type:'superpower' },
  { id:'se8', tool:'Sentry', command:'sentry-cli releases set-commits <ver> --auto', description:'Associate commits with a release using Git integration', difficulty:'advanced', type:'superpower' }
];

// ===== STATE =====
const STORAGE_KEY = 'boots-terminal-buddy-commands';
const TOOLS_STORAGE_KEY = 'boots-terminal-buddy-tools';
let customCommands = [];
let customTools = {};
let activeTool = 'All';
let activeFilter = 'all';
let searchQuery = '';
let parsedImportCommands = [];

// ===== INIT =====
function init() {
  loadCustomTools();
  loadCustomCommands();
  buildSidebar();
  buildMobilePills();
  renderCards();
  updateStats();
  setupSearch();
  setupFilterChips();
  setupDragDrop();
}

// ===== CUSTOM TOOLS =====
function loadCustomTools() {
  try {
    const stored = localStorage.getItem(TOOLS_STORAGE_KEY);
    customTools = stored ? JSON.parse(stored) : {};
  } catch { customTools = {}; }
  Object.keys(customTools).forEach(name => {
    if (!TOOL_CONFIG[name]) {
      TOOL_CONFIG[name] = customTools[name];
    }
  });
}

function saveCustomTools() {
  localStorage.setItem(TOOLS_STORAGE_KEY, JSON.stringify(customTools));
}

function getAllToolNames() {
  return Object.keys(TOOL_CONFIG);
}

function populateToolDropdown(selectEl, selectedValue) {
  // Build options using DOM methods to avoid innerHTML XSS
  selectEl.textContent = '';
  getAllToolNames().forEach(t => {
    const opt = document.createElement('option');
    opt.value = t;
    opt.textContent = t;
    if (t === selectedValue) opt.selected = true;
    selectEl.appendChild(opt);
  });
  const newOpt = document.createElement('option');
  newOpt.value = '__new__';
  newOpt.textContent = '+ New Tool...';
  selectEl.appendChild(newOpt);
}

function onToolSelectChange(select) {
  const fields = document.getElementById('new-tool-fields');
  if (select.value === '__new__') {
    fields.classList.add('show');
    document.getElementById('new-tool-name').focus();
  } else {
    fields.classList.remove('show');
  }
}

// ===== LOCAL STORAGE =====
function loadCustomCommands() {
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    customCommands = stored ? JSON.parse(stored) : [];
  } catch { customCommands = []; }
}

function saveCustomCommands() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(customCommands));
}

// ===== ALL COMMANDS =====
function getAllCommands() {
  const builtIn = BUILTIN_COMMANDS.map(c => ({ ...c, source: 'builtin' }));
  const custom = customCommands.map(c => ({ ...c, source: 'custom' }));
  return [...builtIn, ...custom];
}

// ===== SIDEBAR =====
function buildSidebar() {
  const all = getAllCommands();
  const tools = Object.keys(TOOL_CONFIG);
  const counts = {};
  tools.forEach(t => { counts[t] = 0; });
  all.forEach(c => { if (counts[c.tool] !== undefined) counts[c.tool]++; });

  const container = document.getElementById('sidebar-list');
  container.textContent = '';

  // "All" item
  const allItem = createSidebarItem('All', '&#128203;', all.length, activeTool === 'All');
  container.appendChild(allItem);

  tools.forEach(tool => {
    const cfg = TOOL_CONFIG[tool];
    // Only show tools that have commands
    if (counts[tool] > 0 || customTools[tool]) {
      const item = createSidebarItem(tool, cfg.icon, counts[tool], activeTool === tool);
      container.appendChild(item);
    }
  });
}

function createSidebarItem(tool, iconHTML, count, isActive) {
  const div = document.createElement('div');
  div.className = 'sidebar-item' + (isActive ? ' active' : '');
  div.onclick = () => selectTool(tool);

  const icon = document.createElement('span');
  icon.className = 'sidebar-item-icon';
  icon.innerHTML = iconHTML;

  const label = document.createElement('span');
  label.className = 'sidebar-item-label';
  label.textContent = tool;

  // Edit button for custom tools
  if (customTools[tool]) {
    const editBtn = document.createElement('button');
    editBtn.className = 'sidebar-item-edit';
    editBtn.textContent = '\u270E';
    editBtn.title = 'Edit tool';
    editBtn.onclick = (e) => { e.stopPropagation(); openEditToolModal(tool); };
    label.appendChild(editBtn);
  }

  const countEl = document.createElement('span');
  countEl.className = 'sidebar-item-count';
  countEl.textContent = count;

  div.appendChild(icon);
  div.appendChild(label);
  div.appendChild(countEl);
  return div;
}

// ===== MOBILE PILLS =====
function buildMobilePills() {
  const all = getAllCommands();
  const tools = Object.keys(TOOL_CONFIG);
  const container = document.getElementById('mobile-pills');
  container.textContent = '';

  const allPill = document.createElement('button');
  allPill.className = 'mobile-pill' + (activeTool === 'All' ? ' active' : '');
  allPill.textContent = 'All (' + all.length + ')';
  allPill.onclick = () => selectTool('All');
  container.appendChild(allPill);

  tools.forEach(tool => {
    const count = all.filter(c => c.tool === tool).length;
    if (count > 0 || customTools[tool]) {
      const pill = document.createElement('button');
      pill.className = 'mobile-pill' + (activeTool === tool ? ' active' : '');
      pill.textContent = tool + ' (' + count + ')';
      pill.onclick = () => selectTool(tool);
      container.appendChild(pill);
    }
  });
}

// ===== SELECT TOOL =====
function selectTool(tool) {
  activeTool = tool;
  buildSidebar();
  buildMobilePills();
  renderCards();
}

// ===== SEARCH =====
function setupSearch() {
  document.getElementById('search-input').addEventListener('input', function() {
    searchQuery = this.value.toLowerCase().trim();
    renderCards();
  });
}

// ===== FILTER CHIPS =====
function setupFilterChips() {
  document.querySelectorAll('.filter-chip').forEach(chip => {
    chip.addEventListener('click', function() {
      document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
      this.classList.add('active');
      activeFilter = this.dataset.filter;
      renderCards();
    });
  });
}

// ===== RENDER CARDS =====
function renderCards() {
  let commands = getAllCommands();

  // Filter by tool
  if (activeTool !== 'All') {
    commands = commands.filter(c => c.tool === activeTool);
  }

  // Filter by type/difficulty tag
  if (activeFilter !== 'all') {
    commands = commands.filter(c => c.type === activeFilter || c.difficulty === activeFilter);
  }

  // Filter by search
  if (searchQuery) {
    commands = commands.filter(c =>
      c.command.toLowerCase().includes(searchQuery) ||
      c.description.toLowerCase().includes(searchQuery) ||
      c.tool.toLowerCase().includes(searchQuery)
    );
  }

  const grid = document.getElementById('command-grid');
  const info = document.getElementById('results-info');

  if (commands.length === 0) {
    info.textContent = '';
    grid.innerHTML = `<div class="no-results">
      <div class="no-results-icon">&#128269;</div>
      <h3>No commands found</h3>
      <p>Try adjusting your search or filters</p>
    </div>`;
    return;
  }

  info.textContent = `Showing ${commands.length} command${commands.length !== 1 ? 's' : ''}`;

  grid.textContent = '';
  commands.forEach(cmd => {
    const cfg = TOOL_CONFIG[cmd.tool] || { icon: '\u{1F4C4}', color: '#888' };
    const isDanger = cmd.type === 'danger-zone';
    const isCustom = cmd.source === 'custom';

    const card = document.createElement('div');
    card.className = 'command-card' + (isDanger ? ' danger' : '');

    // Top row: tool badge + tags
    const top = document.createElement('div');
    top.className = 'card-top';
    const badge = document.createElement('span');
    badge.className = 'card-tool-badge';
    badge.style.background = cfg.color;
    badge.innerHTML = cfg.icon + ' ';
    badge.appendChild(document.createTextNode(cmd.tool));
    top.appendChild(badge);

    const badges = document.createElement('div');
    badges.className = 'card-badges';
    const tagMap = {
      'most-used': ['tag-most-used', 'Most Used'],
      'superpower': ['tag-superpower', 'Superpower'],
      'danger-zone': ['tag-danger-zone', 'Danger Zone']
    };
    const diffMap = {
      'beginner': ['tag-beginner', 'Beginner'],
      'intermediate': ['tag-intermediate', 'Intermediate'],
      'advanced': ['tag-advanced', 'Advanced']
    };
    if (tagMap[cmd.type]) {
      const t = document.createElement('span');
      t.className = 'card-tag ' + tagMap[cmd.type][0];
      t.textContent = tagMap[cmd.type][1];
      badges.appendChild(t);
    }
    if (diffMap[cmd.difficulty]) {
      const d = document.createElement('span');
      d.className = 'card-tag ' + diffMap[cmd.difficulty][0];
      d.textContent = diffMap[cmd.difficulty][1];
      badges.appendChild(d);
    }
    if (isCustom) {
      const c = document.createElement('span');
      c.className = 'card-tag tag-custom';
      c.textContent = 'Custom';
      badges.appendChild(c);
    }
    top.appendChild(badges);
    card.appendChild(top);

    // Description
    const desc = document.createElement('div');
    desc.className = 'card-desc';
    desc.textContent = cmd.description;
    card.appendChild(desc);

    // Code block
    const codeWrapper = document.createElement('div');
    codeWrapper.className = 'card-code-wrapper';
    const codeEl = document.createElement('div');
    codeEl.className = 'card-code';
    codeEl.textContent = cmd.command;
    codeWrapper.appendChild(codeEl);
    const copyBtn = document.createElement('button');
    copyBtn.className = 'copy-btn';
    copyBtn.title = 'Copy to clipboard';
    copyBtn.innerHTML = '&#128203;';
    copyBtn.onclick = function() { copyCommand(this, cmd.command); };
    codeWrapper.appendChild(copyBtn);
    card.appendChild(codeWrapper);

    // Difficulty
    const diff = document.createElement('div');
    diff.className = 'card-difficulty';
    diff.textContent = cmd.difficulty.charAt(0).toUpperCase() + cmd.difficulty.slice(1) + ' level';
    card.appendChild(diff);

    // Edit/Delete for custom commands
    if (isCustom) {
      const actions = document.createElement('div');
      actions.className = 'card-actions';

      const editBtn = document.createElement('button');
      editBtn.className = 'card-action-btn';
      editBtn.textContent = '\u270E Edit';
      editBtn.onclick = () => openEditCommandModal(cmd.id);
      actions.appendChild(editBtn);

      const delBtn = document.createElement('button');
      delBtn.className = 'card-action-btn delete-btn';
      delBtn.textContent = '\u2715 Delete';
      delBtn.onclick = () => deleteCommand(cmd.id);
      actions.appendChild(delBtn);

      card.appendChild(actions);
    }

    grid.appendChild(card);
  });
}

// ===== COPY =====
function copyCommand(btn, text) {
  navigator.clipboard.writeText(text).then(() => {
    btn.classList.add('copied');
    btn.innerHTML = '&#10003;';
    showToast('&#10003;', 'Copied to clipboard!');
    setTimeout(() => {
      btn.classList.remove('copied');
      btn.innerHTML = '&#128203;';
    }, 1500);
  }).catch(() => {
    showToast('&#9888;', 'Failed to copy');
  });
}

// ===== TOAST =====
function showToast(icon, message) {
  const toast = document.getElementById('toast');
  document.getElementById('toast-icon').innerHTML = icon;
  document.getElementById('toast-message').textContent = message;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2500);
}

// ===== STATS =====
function updateStats() {
  const all = getAllCommands();
  const tools = new Set(all.map(c => c.tool));
  document.getElementById('stat-commands').textContent = all.length;
  document.getElementById('stat-tools').textContent = tools.size;
  document.getElementById('stat-custom').textContent = customCommands.length;
}

// ===== ADD COMMAND MODAL =====
function openAddModal() {
  document.getElementById('add-modal').classList.add('show');
  document.getElementById('add-command').value = '';
  document.getElementById('add-description').value = '';
  document.getElementById('new-tool-fields').classList.remove('show');
  document.getElementById('new-tool-name').value = '';
  document.getElementById('new-tool-icon').value = '';
  document.getElementById('new-tool-color').value = '#6366F1';
  document.getElementById('new-tool-color-preview').style.background = '#6366F1';
  populateToolDropdown(document.getElementById('add-tool'));
}

function closeAddModal() {
  document.getElementById('add-modal').classList.remove('show');
}

function saveCommand() {
  let tool = document.getElementById('add-tool').value;
  const command = document.getElementById('add-command').value.trim();
  const description = document.getElementById('add-description').value.trim();
  const difficulty = document.getElementById('add-difficulty').value;
  const type = document.getElementById('add-type').value;

  // Handle new tool creation
  if (tool === '__new__') {
    const toolName = document.getElementById('new-tool-name').value.trim();
    const toolIcon = document.getElementById('new-tool-icon').value.trim() || '\u{1F4E6}';
    const toolColor = document.getElementById('new-tool-color').value;

    if (!toolName) { showToast('\u26A0', 'Tool name is required'); return; }

    // Register the new tool — store raw emoji, not HTML entity
    TOOL_CONFIG[toolName] = { icon: toolIcon, color: toolColor };
    customTools[toolName] = { icon: toolIcon, color: toolColor };
    saveCustomTools();
    tool = toolName;
    showToast('\u2728', toolName + ' tool created!');
  }

  if (!command) { showToast('\u26A0', 'Command is required'); return; }
  if (!description) { showToast('\u26A0', 'Description is required'); return; }

  const newCmd = {
    id: 'custom-' + Date.now(),
    tool,
    command,
    description,
    difficulty,
    type,
    source: 'custom',
    createdAt: new Date().toISOString()
  };

  customCommands.push(newCmd);
  saveCustomCommands();
  closeAddModal();
  buildSidebar();
  buildMobilePills();
  renderCards();
  updateStats();
  showToast('\u2713', 'Command added!');
}

// ===== EDIT COMMAND MODAL =====
function openEditCommandModal(cmdId) {
  const cmd = customCommands.find(c => c.id === cmdId);
  if (!cmd) return;

  document.getElementById('edit-cmd-id').value = cmdId;
  document.getElementById('edit-cmd-command').value = cmd.command;
  document.getElementById('edit-cmd-description').value = cmd.description;
  document.getElementById('edit-cmd-difficulty').value = cmd.difficulty;
  document.getElementById('edit-cmd-type').value = cmd.type;
  populateToolDropdown(document.getElementById('edit-cmd-tool'), cmd.tool);
  document.getElementById('edit-cmd-modal').classList.add('show');
}

function closeEditCommandModal() {
  document.getElementById('edit-cmd-modal').classList.remove('show');
}

function saveEditCommand() {
  const cmdId = document.getElementById('edit-cmd-id').value;
  const cmd = customCommands.find(c => c.id === cmdId);
  if (!cmd) return;

  const newTool = document.getElementById('edit-cmd-tool').value;
  const newCommand = document.getElementById('edit-cmd-command').value.trim();
  const newDesc = document.getElementById('edit-cmd-description').value.trim();

  if (!newCommand) { showToast('\u26A0', 'Command is required'); return; }
  if (!newDesc) { showToast('\u26A0', 'Description is required'); return; }

  cmd.tool = newTool;
  cmd.command = newCommand;
  cmd.description = newDesc;
  cmd.difficulty = document.getElementById('edit-cmd-difficulty').value;
  cmd.type = document.getElementById('edit-cmd-type').value;

  saveCustomCommands();
  closeEditCommandModal();
  buildSidebar();
  buildMobilePills();
  renderCards();
  updateStats();
  showToast('\u2713', 'Command updated!');
}

function deleteCommand(cmdId) {
  const cmd = customCommands.find(c => c.id === cmdId);
  if (!cmd) return;
  if (!confirm('Delete this command?\n\n' + cmd.command)) return;

  customCommands = customCommands.filter(c => c.id !== cmdId);
  saveCustomCommands();
  buildSidebar();
  buildMobilePills();
  renderCards();
  updateStats();
  showToast('\u2713', 'Command deleted');
}

// ===== EDIT TOOL MODAL =====
function openEditToolModal(toolName) {
  const cfg = TOOL_CONFIG[toolName];
  if (!cfg) return;

  document.getElementById('edit-tool-original-name').value = toolName;
  document.getElementById('edit-tool-name').value = toolName;
  document.getElementById('edit-tool-icon').value = cfg.icon;
  document.getElementById('edit-tool-color').value = cfg.color;
  document.getElementById('edit-tool-color-preview').style.background = cfg.color;
  updateEditToolPreview();
  document.getElementById('edit-tool-modal').classList.add('show');
}

function closeEditToolModal() {
  document.getElementById('edit-tool-modal').classList.remove('show');
}

function updateEditToolPreview() {
  const name = document.getElementById('edit-tool-name').value || 'Tool';
  const icon = document.getElementById('edit-tool-icon').value || '\u{1F4E6}';
  const color = document.getElementById('edit-tool-color').value;
  const preview = document.getElementById('edit-tool-preview');
  preview.textContent = '';
  const badge = document.createElement('span');
  badge.className = 'edit-tool-preview-badge';
  badge.style.background = color;
  badge.textContent = icon + ' ' + name;
  const hint = document.createElement('span');
  hint.style.cssText = 'font-size:0.8rem;color:#6C757D;';
  hint.textContent = 'Preview of how it will look';
  preview.appendChild(badge);
  preview.appendChild(hint);
}

function saveEditTool() {
  const originalName = document.getElementById('edit-tool-original-name').value;
  const newName = document.getElementById('edit-tool-name').value.trim();
  const newIcon = document.getElementById('edit-tool-icon').value.trim() || '\u{1F4E6}';
  const newColor = document.getElementById('edit-tool-color').value;

  if (!newName) { showToast('\u26A0', 'Tool name is required'); return; }

  // Update TOOL_CONFIG
  if (newName !== originalName) {
    delete TOOL_CONFIG[originalName];
    delete customTools[originalName];
    // Update all custom commands that used the old name
    customCommands.forEach(cmd => {
      if (cmd.tool === originalName) cmd.tool = newName;
    });
    saveCustomCommands();
    if (activeTool === originalName) activeTool = newName;
  }

  TOOL_CONFIG[newName] = { icon: newIcon, color: newColor };
  customTools[newName] = { icon: newIcon, color: newColor };
  saveCustomTools();

  closeEditToolModal();
  buildSidebar();
  buildMobilePills();
  renderCards();
  updateStats();
  showToast('\u2713', newName + ' updated!');
}

function deleteCustomTool() {
  const toolName = document.getElementById('edit-tool-original-name').value;
  const cmdCount = customCommands.filter(c => c.tool === toolName).length;
  const msg = cmdCount > 0
    ? 'Delete "' + toolName + '" and its ' + cmdCount + ' custom command' + (cmdCount !== 1 ? 's' : '') + '?'
    : 'Delete "' + toolName + '"?';

  if (!confirm(msg)) return;

  // Remove commands for this tool
  customCommands = customCommands.filter(c => c.tool !== toolName);
  saveCustomCommands();

  // Remove tool
  delete TOOL_CONFIG[toolName];
  delete customTools[toolName];
  saveCustomTools();

  if (activeTool === toolName) activeTool = 'All';

  closeEditToolModal();
  buildSidebar();
  buildMobilePills();
  renderCards();
  updateStats();
  showToast('\u2713', toolName + ' deleted');
}

// ===== IMPORT =====
function openImportModal() {
  document.getElementById('import-modal').classList.add('show');
  document.getElementById('import-preview').style.display = 'none';
  document.getElementById('import-confirm-btn').style.display = 'none';
  parsedImportCommands = [];
}

function closeImportModal() {
  document.getElementById('import-modal').classList.remove('show');
}

function setupDragDrop() {
  const dropZone = document.getElementById('drop-zone');
  const fileInput = document.getElementById('file-input');

  dropZone.addEventListener('click', () => fileInput.click());

  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('drag-over');
  });

  dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('drag-over');
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    const file = e.dataTransfer.files[0];
    if (file) processFile(file);
  });

  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) processFile(file);
    fileInput.value = '';
  });
}

function processFile(file) {
  const reader = new FileReader();
  reader.onload = (e) => {
    const text = e.target.result;
    parsedImportCommands = parseMarkdown(text);

    if (parsedImportCommands.length === 0) {
      showToast('&#9888;', 'No commands found in file');
      return;
    }

    showImportPreview(file.name, parsedImportCommands);
  };
  reader.readAsText(file);
}

// ===== MARKDOWN PARSER =====
function parseMarkdown(text) {
  const lines = text.split('\n');
  const commands = [];
  let currentCategory = '';
  let inCodeBlock = false;
  let codeBlockLines = [];

  const prefixMap = {
    docker: 'Docker',
    git: 'Git/GitHub',
    gh: 'Git/GitHub',
    claude: 'Claude Code',
    vercel: 'Vercel',
    supabase: 'Supabase',
    gcloud: 'Google Cloud Run',
    fly: 'Fly.io',
    flyctl: 'Fly.io',
    npm: 'npm/Node.js',
    npx: 'npm/Node.js',
    node: 'npm/Node.js',
    'sentry-cli': 'Sentry',
    ls: 'Mac/Terminal',
    cd: 'Mac/Terminal',
    mkdir: 'Mac/Terminal',
    rm: 'Mac/Terminal',
    cat: 'Mac/Terminal',
    grep: 'Mac/Terminal',
    find: 'Mac/Terminal',
    chmod: 'Mac/Terminal',
    kill: 'Mac/Terminal',
    lsof: 'Mac/Terminal',
    du: 'Mac/Terminal',
    pbcopy: 'Mac/Terminal'
  };

  function detectTool(cmd) {
    const firstWord = cmd.trim().split(/\s+/)[0].toLowerCase();
    // Check compound prefix first
    if (firstWord === 'sentry-cli') return 'Sentry';
    return prefixMap[firstWord] || 'Mac/Terminal';
  }

  for (let i = 0; i < lines.length; i++) {
    const line = lines[i];

    // Heading detection
    const headingMatch = line.match(/^#{1,3}\s+(.+)/);
    if (headingMatch && !inCodeBlock) {
      currentCategory = headingMatch[1].trim();
      continue;
    }

    // Fenced code block
    if (line.trim().startsWith('```')) {
      if (inCodeBlock) {
        // End of code block — process collected lines
        codeBlockLines.forEach(cl => {
          const trimmed = cl.trim();
          if (trimmed && !trimmed.startsWith('#') && !trimmed.startsWith('//')) {
            commands.push({
              command: trimmed,
              description: currentCategory || 'Imported command',
              tool: detectTool(trimmed),
              difficulty: 'intermediate',
              type: 'most-used'
            });
          }
        });
        codeBlockLines = [];
        inCodeBlock = false;
      } else {
        inCodeBlock = true;
      }
      continue;
    }

    if (inCodeBlock) {
      codeBlockLines.push(line);
      continue;
    }

    // Inline code in list items: - `command` description or - `command` — description
    const inlineMatch = line.match(/^[-*]\s+`([^`]+)`\s*[—\-:]?\s*(.*)/);
    if (inlineMatch) {
      const cmd = inlineMatch[1].trim();
      const desc = inlineMatch[2].trim() || currentCategory || 'Imported command';
      commands.push({
        command: cmd,
        description: desc,
        tool: detectTool(cmd),
        difficulty: 'intermediate',
        type: 'most-used'
      });
    }
  }

  return commands;
}

// ===== IMPORT PREVIEW =====
function showImportPreview(filename, commands) {
  const preview = document.getElementById('import-preview');
  preview.textContent = '';

  // File info
  const info = document.createElement('div');
  info.className = 'import-file-info';
  info.textContent = filename + ' \u2014 ' + commands.length + ' command' + (commands.length !== 1 ? 's' : '') + ' found';
  preview.appendChild(info);

  // Scrollable table wrapper
  const wrapper = document.createElement('div');
  wrapper.style.cssText = 'max-height:300px;overflow-y:auto;';

  const table = document.createElement('table');
  table.className = 'import-preview-table';

  const thead = document.createElement('thead');
  const headRow = document.createElement('tr');
  ['Command', 'Description', 'Tool'].forEach(text => {
    const th = document.createElement('th');
    th.textContent = text;
    headRow.appendChild(th);
  });
  thead.appendChild(headRow);
  table.appendChild(thead);

  const tbody = document.createElement('tbody');
  commands.forEach((cmd, i) => {
    const tr = document.createElement('tr');

    const tdCmd = document.createElement('td');
    const code = document.createElement('code');
    code.textContent = cmd.command;
    tdCmd.appendChild(code);
    tr.appendChild(tdCmd);

    const tdDesc = document.createElement('td');
    tdDesc.style.cssText = 'font-size:0.75rem;max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;';
    tdDesc.title = cmd.description;
    tdDesc.textContent = cmd.description;
    tr.appendChild(tdDesc);

    const tdTool = document.createElement('td');
    const select = document.createElement('select');
    select.id = 'import-tool-' + i;
    select.style.cssText = 'font-size:0.72rem;padding:0.2rem 0.3rem;';
    getAllToolNames().forEach(t => {
      const opt = document.createElement('option');
      opt.value = t;
      opt.textContent = t;
      if (t === cmd.tool) opt.selected = true;
      select.appendChild(opt);
    });
    tdTool.appendChild(select);
    tr.appendChild(tdTool);

    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
  wrapper.appendChild(table);
  preview.appendChild(wrapper);

  preview.style.display = 'block';
  document.getElementById('import-confirm-btn').style.display = 'inline-flex';
}

function confirmImport() {
  parsedImportCommands.forEach((cmd, i) => {
    const toolSelect = document.getElementById('import-tool-' + i);
    if (toolSelect) cmd.tool = toolSelect.value;

    customCommands.push({
      id: 'import-' + Date.now() + '-' + i,
      tool: cmd.tool,
      command: cmd.command,
      description: cmd.description,
      difficulty: cmd.difficulty || 'intermediate',
      type: cmd.type || 'most-used',
      source: 'custom',
      createdAt: new Date().toISOString()
    });
  });

  saveCustomCommands();
  closeImportModal();
  buildSidebar();
  buildMobilePills();
  renderCards();
  updateStats();
  showToast('&#10003;', `${parsedImportCommands.length} command${parsedImportCommands.length !== 1 ? 's' : ''} imported!`);
}

// ===== EXPORT =====
function exportCommands() {
  if (customCommands.length === 0) {
    showToast('&#9888;', 'No custom commands to export');
    return;
  }

  const byTool = {};
  customCommands.forEach(cmd => {
    if (!byTool[cmd.tool]) byTool[cmd.tool] = [];
    byTool[cmd.tool].push(cmd);
  });

  let md = '# Terminal Buddy — Custom Commands\n\n';
  md += `_Exported on ${new Date().toLocaleDateString()}_\n\n`;

  Object.keys(byTool).sort().forEach(tool => {
    md += `## ${tool}\n\n`;
    byTool[tool].forEach(cmd => {
      md += `- \`${cmd.command}\` — ${cmd.description}\n`;
    });
    md += '\n';
  });

  const blob = new Blob([md], { type: 'text/markdown' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'terminal-buddy-commands.md';
  a.click();
  URL.revokeObjectURL(url);
  showToast('&#10003;', 'Commands exported!');
}

// ===== START =====
document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
